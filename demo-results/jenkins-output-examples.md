# Jenkins Pipeline Output Examples
## Generated by Lumos Advanced Pattern Engine

### Original Error Message
```
"Timed out waiting 300000ms from config.webServer. ELIFECYCLE Command failed with exit code 1"
```

---

## 1. Jenkins Console Output (`--jenkins`)

```
========================================
🔮 LUMOS ERROR ANALYSIS REPORT
========================================

ERROR: Timed out waiting 300000ms from config.webServer. ELIFECYCLE Command failed with exit code 1
CATEGORY: WebServer Lifecycle Timeout
SEVERITY: MEDIUM
CONFIDENCE: 80%

PRIMARY SOLUTION:
  Re-run your tests - 70% success rate for transient issues

ADDITIONAL SOLUTIONS:
  1. Kill existing processes: pkill -f "node.*dev" && lsof -ti:3000 | xargs kill -9
  2. Increase webServer timeout in playwright.config.ts to 600000ms (10 minutes)
  3. Check if dev server starts independently: npm run dev

JENKINS RECOMMENDATION:
  Action: RETRY
  Success Probability: 80%
  Estimated Fix Time: 2-5 minutes

ACTION ITEMS:
  1. Re-run your tests - 70% success rate for transient issues
  2. Check system resources and network connectivity
  3. Increase timeout values in configuration
  4. Monitor subsequent builds for pattern recurrence

========================================
Analysis by Lumos Advanced Pattern Engine
No API keys required - Full offline analysis
========================================
```

---

## 2. Jenkins JSON Report (`--jenkins-json`)

```json
{
  "status": "warning",
  "timestamp": "2025-09-23T09:59:48.000Z",
  "error": {
    "message": "Timed out waiting 300000ms from config.webServer. ELIFECYCLE Command failed with exit code 1",
    "category": "WebServer Lifecycle Timeout",
    "severity": "medium",
    "confidence": 0.8
  },
  "solutions": {
    "primary": "Re-run your tests - 70% success rate for transient issues",
    "alternatives": [
      "Kill existing processes: pkill -f \"node.*dev\" && lsof -ti:3000 | xargs kill -9",
      "Increase webServer timeout in playwright.config.ts to 600000ms (10 minutes)",
      "Check if dev server starts independently: npm run dev",
      "Clear node_modules and reinstall: rm -rf node_modules && npm install",
      "Check system memory and CPU usage"
    ],
    "quickFix": "npx playwright test --timeout=600000"
  },
  "relatedFiles": [
    "playwright.config.ts",
    "package.json",
    "vite.config.js",
    "next.config.js"
  ],
  "jenkins": {
    "buildRecommendation": "retry",
    "estimatedFixTime": "2-5 minutes",
    "successProbability": 80,
    "actionItems": [
      "Re-run your tests - 70% success rate for transient issues",
      "Check system resources and network connectivity",
      "Increase timeout values in configuration",
      "Monitor subsequent builds for pattern recurrence"
    ]
  },
  "metrics": {
    "analysisTimeMs": 2500,
    "patternsMatched": 4,
    "confidenceLevel": "HIGH"
  }
}
```

---

## 3. Jenkins Pipeline Script (`--jenkins-pipeline`)

```groovy
// Auto-generated Jenkins Pipeline Error Handler
// Generated by Lumos Advanced Pattern Engine

pipeline {
    agent any
    
    stages {
        stage('Error Analysis') {
            steps {
                script {
                    def errorCategory = "webserver lifecycle timeout"
                    def confidence = 80
                    def severity = "medium"
                    
                    echo "🔮 Lumos Error Analysis Results:"
                    echo "  Category: ${errorCategory}"
                    echo "  Confidence: ${confidence}%"
                    echo "  Severity: ${severity}"
                    
                    // Automated decision based on analysis
                    if (confidence >= 80 && severity in ['low', 'medium']) {
                        echo "✅ Auto-retry recommended (High confidence)"
                        
                        // High confidence auto-retry
                        retry(3) {
                            echo "🔄 Retrying build (Lumos confidence: 80%)"
                            // Add your build/test commands here
                            sh 'npm test'
                        }
                    } else if (confidence >= 60) {
                        echo "⚠️  Manual investigation recommended"
                        
                        // Manual investigation required
                        echo "🔍 Manual investigation steps:"
                        echo "  1. Re-run your tests - 70% success rate for transient issues"
                        echo "  2. Kill existing processes: pkill -f \"node.*dev\" && lsof -ti:3000 | xargs kill -9"
                        echo "  3. Increase webServer timeout in playwright.config.ts to 600000ms (10 minutes)"
                        
                        // Wait for manual approval
                        input message: 'Investigate the error and approve to continue', ok: 'Continue'
                    } else {
                        echo "❌ Critical fix required - Build failed"
                        currentBuild.result = 'FAILURE'
                        error("Critical error requires manual intervention")
                    }
                }
            }
        }
        
        stage('Automated Fixes') {
            when {
                expression { 
                    return true
                }
            }
            steps {
                script {
                    echo "🔧 Applying automated fixes..."
                    
                    // Automated timeout fix
                    sh 'pkill -f "node.*dev" || true'
                    sh 'lsof -ti:3000 | xargs kill -9 || true'
                    sleep 5
                    echo "✅ Processes cleared, retrying..."
                }
            }
        }
    }
    
    post {
        always {
            script {
                // Log analysis results for monitoring
                def analysisData = [
                    category: "webserver lifecycle timeout",
                    confidence: 80,
                    severity: "medium",
                    quickSolution: "Re-run your tests - 70% success rate for transient issues",
                    timestamp: new Date().format('yyyy-MM-dd HH:mm:ss')
                ]
                
                writeJSON file: 'lumos-analysis.json', json: analysisData
                archiveArtifacts artifacts: 'lumos-analysis.json', fingerprint: true
            }
        }
        
        failure {
            script {
                echo "📧 Sending error analysis to development team..."
                // Add notification logic here
            }
        }
    }
}
```

---

## What Happens in Your Jenkins Pipeline

### 1. **Automatic Error Detection**
When your build fails with this webServer timeout error, the pipeline:
- ✅ **Detects**: `webserver-lifecycle-timeout` with 80% confidence
- ✅ **Classifies**: Medium severity, retry recommended
- ✅ **Decides**: Auto-retry (3 attempts) due to high confidence

### 2. **Auto-Retry Logic**
```groovy
retry(3) {
    echo "🔄 Retrying build (Lumos confidence: 80%)"
    sh 'npm test'  // Your actual test command
}
```

### 3. **Automated Cleanup**
Before retry, the pipeline automatically:
```bash
pkill -f "node.*dev"           # Kill stuck dev servers
lsof -ti:3000 | xargs kill -9  # Free up port 3000
sleep 5                        # Wait for cleanup
```

### 4. **Success Tracking**
- Archives analysis results in `lumos-analysis.json`
- Tracks pattern frequency for learning
- Provides metrics for build optimization

## Real Jenkins Console Log Example

```
[Pipeline] stage
[Pipeline] { (Error Analysis)
[Pipeline] script
[Pipeline] {
[Pipeline] echo
🔮 Lumos Error Analysis Results:
[Pipeline] echo
  Category: webserver lifecycle timeout
[Pipeline] echo
  Confidence: 80%
[Pipeline] echo
  Severity: medium
[Pipeline] echo
✅ Auto-retry recommended (High confidence)
[Pipeline] retry
[Pipeline] {
[Pipeline] echo
🔄 Retrying build (Lumos confidence: 80%)
[Pipeline] sh
+ npm test
> my-project@1.0.0 test
> playwright test

Running 15 tests using 3 workers
✓ test-1.spec.ts:3:1 › basic test (1.2s)
✓ test-2.spec.ts:5:1 › form submission (2.1s)
... tests pass on retry ...

[Pipeline] }
[Pipeline] // retry
[Pipeline] echo
🔧 Applying automated fixes...
[Pipeline] sh
+ pkill -f 'node.*dev'
[Pipeline] sh
+ lsof -ti:3000
+ xargs kill -9
[Pipeline] sleep
Sleeping for 5 sec
[Pipeline] echo
✅ Processes cleared, retrying...
[Pipeline] writeJSON
[Pipeline] archiveArtifacts
Archiving artifacts
[Pipeline] echo
✅ Build recovered successfully after Lumos analysis
```

## Usage Commands

```bash
# Generate Jenkins console output
lumos analyze "Timed out waiting 300000ms from config.webServer" --jenkins

# Save JSON report for CI/CD integration
lumos analyze "Timed out waiting 300000ms from config.webServer" --jenkins-json --output error-report.json

# Generate complete pipeline script
lumos analyze "Timed out waiting 300000ms from config.webServer" --jenkins-pipeline --output Jenkinsfile-lumos
```

This shows exactly how Lumos integrates with Jenkins to provide intelligent, automated error handling without requiring any API keys!
